<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frequ√™ncia por Curso ‚Äî CEDESP Dom Bosco Itaquera</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root {
  --bg:#f5f2ee;--surface:#fff;--surface2:#ede9e3;--border:#d8d2c8;
  --text:#1a1612;--text-muted:#8a8279;--accent:#c84b31;--accent2:#2b5f8a;
  --green:#2d7a4f;--orange:#c97c1a;--yellow:#e8c547;--ink:#1a1612;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Poppins',sans-serif;min-height:100vh}
header{background:var(--ink);color:#f5f2ee;padding:0 48px;display:flex;align-items:stretch;justify-content:space-between;height:80px;position:sticky;top:0;z-index:100}
.header-left{display:flex;align-items:center;gap:20px}
.header-accent{width:4px;height:40px;background:var(--accent);border-radius:2px}
.header-title{font-family:'Poppins',sans-serif;font-weight:800;font-size:17px;letter-spacing:-0.3px;line-height:1.25}
.header-sub{font-family:'JetBrains Mono',monospace;font-size:10px;color:rgba(245,242,238,.45);margin-top:3px;letter-spacing:.5px}
.header-right{display:flex;align-items:center;gap:32px}
.header-stat{text-align:right}
.hs-val{font-family:'Poppins',sans-serif;font-size:22px;font-weight:700;letter-spacing:-.5px;color:var(--yellow)}
.hs-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:rgba(245,242,238,.45);letter-spacing:.5px}
.controls{background:var(--surface);border-bottom:1px solid var(--border);padding:14px 48px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;position:sticky;top:80px;z-index:99}
.filter-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);letter-spacing:.5px;text-transform:uppercase}
.filter-btn{display:inline-flex;align-items:center;padding:5px 14px;border-radius:2px;border:1px solid var(--border);background:transparent;color:var(--text-muted);font-family:'Poppins',sans-serif;font-size:12px;cursor:pointer;transition:all .15s}
.filter-btn:hover{border-color:var(--ink);color:var(--ink)}
.filter-btn.active{background:var(--ink);color:var(--bg);border-color:var(--ink)}
.filter-btn.manha.active{background:var(--orange);border-color:var(--orange);color:#fff}
.filter-btn.tarde.active{background:var(--accent2);border-color:var(--accent2);color:#fff}
.filter-btn.noite.active{background:#4a3a7a;border-color:#4a3a7a;color:#fff}
.sort-select{padding:5px 28px 5px 12px;border:1px solid var(--border);background:transparent;font-family:'Poppins',sans-serif;font-size:12px;color:var(--text);border-radius:2px;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%238a8279' stroke-width='1.5' fill='none'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center}
.controls-spacer{flex:1}
.search-wrap{position:relative}
.search-input{padding:6px 12px 6px 32px;border:1px solid var(--border);background:var(--bg);font-family:'Poppins',sans-serif;font-size:12px;color:var(--text);border-radius:2px;width:220px;outline:none}
.search-input:focus{border-color:var(--ink)}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text-muted);font-size:12px}
main{padding:32px 48px 60px;max-width:1440px;margin:0 auto}
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1px;background:var(--border);border:1px solid var(--border);margin-bottom:32px}
.kpi-cell{background:var(--surface);padding:24px 28px}
.kpi-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);letter-spacing:.8px;text-transform:uppercase;margin-bottom:10px}
.kpi-val{font-family:'Poppins',sans-serif;font-size:40px;font-weight:800;letter-spacing:-2px;line-height:1;margin-bottom:4px}
.kpi-desc{font-size:12px;color:var(--text-muted)}
.section-row{display:flex;align-items:baseline;gap:12px;margin-bottom:20px;margin-top:40px}
.section-row:first-child{margin-top:0}
.section-title{font-family:'Poppins',sans-serif;font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted)}
.section-rule{flex:1;height:1px;background:var(--border)}
.section-count{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted)}
.charts-grid{display:grid;grid-template-columns:1.6fr 1fr;gap:20px;margin-bottom:20px}
.chart-box{background:var(--surface);border:1px solid var(--border);padding:24px}
.chart-box-title{font-family:'Poppins',sans-serif;font-size:13px;font-weight:700;letter-spacing:-.2px;margin-bottom:3px}
.chart-box-sub{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:20px}
.course-table-wrap{background:var(--surface);border:1px solid var(--border);overflow:hidden}
table{width:100%;border-collapse:collapse}
thead th{padding:10px 16px;text-align:left;font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:.8px;text-transform:uppercase;color:var(--text-muted);background:var(--surface2);border-bottom:1px solid var(--border);white-space:nowrap}
thead th.right{text-align:right}
tbody tr{border-bottom:1px solid var(--border);transition:background .1s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:var(--surface2)}
td{padding:11px 16px;font-size:12.5px}
td.mono{font-family:'JetBrains Mono',monospace;font-size:11.5px}
td.right{text-align:right}
.course-name-cell{max-width:240px;font-weight:600;font-size:12px;line-height:1.3}
.unit-chip{display:inline-block;padding:2px 8px;border-radius:2px;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:500;background:var(--surface2);color:var(--text-muted);white-space:nowrap}
.period-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
.period-dot.manh√£{background:var(--orange)}.period-dot.tarde{background:var(--accent2)}.period-dot.noite{background:#4a3a7a}
.rate-cell{min-width:140px}
.rate-wrap{display:flex;align-items:center;gap:8px}
.rate-bar{flex:1;height:5px;background:var(--surface2);overflow:hidden;min-width:60px}
.rate-fill{height:100%}
.rate-pct{font-family:'JetBrains Mono',monospace;font-size:11px;min-width:40px;text-align:right;font-weight:500}
.status-flag{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-family:'JetBrains Mono',monospace;padding:2px 8px;border:1px solid;border-radius:2px}
.status-flag.high{border-color:#2d7a4f;color:#2d7a4f;background:rgba(45,122,79,.06)}
.status-flag.mid{border-color:#c97c1a;color:#c97c1a;background:rgba(201,124,26,.06)}
.status-flag.low{border-color:var(--accent);color:var(--accent);background:rgba(200,75,49,.06)}
.empty-state{text-align:center;padding:48px;color:var(--text-muted);font-size:13px}
.update-badge{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);background:var(--surface2);border:1px solid var(--border);padding:3px 10px;border-radius:2px}
footer{border-top:1px solid var(--border);padding:20px 48px;display:flex;justify-content:space-between;align-items:center;margin-top:48px}
.footer-text{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted)}
@media(max-width:900px){header,.controls,main{padding-left:20px;padding-right:20px}.charts-grid{grid-template-columns:1fr}.kpi-row{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div class="header-accent"></div>
    <div>
      <div class="header-title">Frequ√™ncia por Curso</div>
      <div class="header-sub">CEDESP DOM BOSCO ITAQUERA ¬∑ 1¬∫ SEMESTRE 2026</div>
    </div>
  </div>
  <div class="header-right">
    <div class="header-stat"><div class="hs-val" id="hdr-cursos">‚Äî</div><div class="hs-label">CURSOS</div></div>
    <div class="header-stat"><div class="hs-val" id="hdr-avg">‚Äî</div><div class="hs-label">FREQ. M√âDIA</div></div>
    <div class="header-stat"><div class="hs-val" id="hdr-matr">‚Äî</div><div class="hs-label">MATR√çCULAS</div></div>
  </div>
</header>

<div class="controls">
  <div style="display:flex;align-items:center;gap:6px">
    <span class="filter-label">Unidade:</span>
    <button class="filter-btn active" data-filter="unit" data-value="all">Todas</button>
    <button class="filter-btn" data-filter="unit" data-value="CEDESP 1">C1</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 2">C2</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 3">C3</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 4">C4</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 5">C5</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 6">C6</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 7">C7</button><button class="filter-btn" data-filter="unit" data-value="CEDESP 8">C8</button>
  </div>
  <div style="display:flex;align-items:center;gap:6px">
    <span class="filter-label">Hor√°rio:</span>
    <button class="filter-btn active" data-filter="period" data-value="all">Todos</button>
    <button class="filter-btn manha" data-filter="period" data-value="Manh√£">‚òÄ Manh√£</button>
    <button class="filter-btn tarde" data-filter="period" data-value="Tarde">üå§ Tarde</button>
    <button class="filter-btn noite" data-filter="period" data-value="Noite">üåô Noite</button>
  </div>
  <div class="controls-spacer"></div>
  <span class="update-badge">üìÖ Atualizado em: 23/02/2026 √†s 11:12</span>
  <div style="display:flex;align-items:center;gap:6px">
    <span class="filter-label">Ordenar:</span>
    <select class="sort-select" id="sortSelect">
      <option value="rate-desc">Taxa freq. ‚Üì</option>
      <option value="rate-asc">Taxa freq. ‚Üë</option>
      <option value="matr-desc">Matr√≠culas ‚Üì</option>
      <option value="avg-desc">Freq. m√©dia ‚Üì</option>
      <option value="unit">Unidade</option>
    </select>
  </div>
  <div class="search-wrap">
    <span class="search-icon">‚åï</span>
    <input type="text" class="search-input" id="searchInput" placeholder="Buscar curso...">
  </div>
</div>

<main>

<div class="kpi-row">
  <div class="kpi-cell"><div class="kpi-label">Cursos ativos</div><div class="kpi-val" id="kpi-cursos">‚Äî</div><div class="kpi-desc">turmas com frequ√™ncia registrada</div></div>
  <div class="kpi-cell"><div class="kpi-label">Taxa de frequ√™ncia m√©dia</div><div class="kpi-val" id="kpi-rate" style="color:var(--accent2)">‚Äî</div><div class="kpi-desc">freq. m√©dia √∑ meta do curso</div></div>

  <div class="kpi-cell"><div class="kpi-label">Cursos com taxa &lt;80%</div><div class="kpi-val" id="kpi-low" style="color:var(--accent)">‚Äî</div><div class="kpi-desc">requerem aten√ß√£o</div></div>
  <div class="kpi-cell"><div class="kpi-label">Evas√£o m√©dia</div><div class="kpi-val" id="kpi-evasao" style="color:#c84b31">‚Äî</div><div class="kpi-desc">matriculados que n√£o frequentam</div></div>
</div>

<div class="section-row"><div class="section-title">Vis√£o Gr√°fica</div><div class="section-rule"></div></div>

<div class="charts-grid">
  <div class="chart-box">
    <div class="chart-box-title">Taxa de Frequ√™ncia por Curso</div>
    <div class="chart-box-sub">Frequ√™ncia di√°ria m√©dia √∑ meta do curso ‚Äî top 20 cursos</div>
    <canvas id="courseBarChart" height="320"></canvas>
  </div>
  <div class="chart-box">
    <div class="chart-box-title">Distribui√ß√£o de Taxas</div>
    <div class="chart-box-sub">Agrupamento por faixa de frequ√™ncia</div>
    <canvas id="distChart" height="320"></canvas>
  </div>
</div>
<div class="charts-grid" style="grid-template-columns:1fr 1fr">
  <div class="chart-box">
    <div class="chart-box-title">Cursos Cr√≠ticos por Unidade</div>
    <div class="chart-box-sub">N¬∫ de turmas por faixa de aten√ß√£o em cada CEDESP</div>
    <canvas id="unitCompChart" height="240"></canvas>
  </div>
  <div class="chart-box">
    <div class="chart-box-title">Frequ√™ncia por Hor√°rio</div>
    <div class="chart-box-sub">Taxa m√©dia por per√≠odo do dia</div>
    <canvas id="periodChart" height="240"></canvas>
  </div>
</div>

<div class="charts-grid" style="grid-template-columns:1fr">
  <div class="chart-box">
    <div class="chart-box-title">Evas√£o por Curso ‚Äî Top 20</div>
    <div class="chart-box-sub">Cursos com maior evas√£o ¬∑ matriculados que n√£o frequentam</div>
    <canvas id="evasaoChart" height="160"></canvas>
  </div>
</div>

<div class="section-row">
  <div class="section-title">Tabela Completa</div>
  <div class="section-rule"></div>
  <span class="section-count" id="resultCount">‚Äî</span>
</div>

<div class="course-table-wrap">
  <table id="courseTable">
    <thead>
      <tr>
        <th>Curso</th><th>Unidade</th><th>Per√≠odo</th>
        <th class="right">Matr.</th><th class="right">Freq. M√©dia/dia</th>
        <th class="right">Aulas</th><th>Taxa s\/ Meta</th><th class="right">Evas√£o</th><th>Status</th>
      </tr>
    </thead>
    <tbody id="courseTableBody"></tbody>
  </table>
  <div class="empty-state" id="emptyState" style="display:none">Nenhum curso encontrado.</div>
</div>

</main>

<footer>
  <div class="footer-text">CEDESP Dom Bosco Itaquera ¬∑ Dashboard gerado automaticamente</div>
  <div class="footer-text">Atualizado em 23/02/2026 √†s 11:12</div>
</footer>

<script>
const RAW = [
  {
    "unit": "CEDESP 1",
    "period": "Manh√£",
    "course": "CABELEIREIRO - No√ß√µes de Barbearia",
    "meta": 20.0,
    "matr": 29.0,
    "freq_avg": 18.1,
    "n_classes": 12,
    "attend_rate": 90.5,
    "evasao": 10.9,
    "evasao_pct": 37.6
  },
  {
    "unit": "CEDESP 1",
    "period": "Manh√£",
    "course": "MANICURE E PEDICURE",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 25.2,
    "n_classes": 10,
    "attend_rate": 126.0,
    "evasao": 4.8,
    "evasao_pct": 16.0
  },
  {
    "unit": "CEDESP 1",
    "period": "Manh√£",
    "course": "MONTADOR E REPARADOR DE COMPUTADORES",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 22.7,
    "n_classes": 12,
    "attend_rate": 113.5,
    "evasao": 7.3,
    "evasao_pct": 24.3
  },
  {
    "unit": "CEDESP 1",
    "period": "Manh√£",
    "course": "OPERADOR DE COMPUTADOR",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 22.7,
    "n_classes": 12,
    "attend_rate": 113.5,
    "evasao": 2.3,
    "evasao_pct": 9.2
  },
  {
    "unit": "CEDESP 1",
    "period": "Tarde",
    "course": "CABELEIREIRO",
    "meta": 20.0,
    "matr": 33.0,
    "freq_avg": 27.1,
    "n_classes": 12,
    "attend_rate": 135.5,
    "evasao": 5.9,
    "evasao_pct": 17.9
  },
  {
    "unit": "CEDESP 1",
    "period": "Tarde",
    "course": "MANICURE E PEDICURE",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 19.8,
    "n_classes": 12,
    "attend_rate": 99.0,
    "evasao": 10.2,
    "evasao_pct": 34.0
  },
  {
    "unit": "CEDESP 1",
    "period": "Tarde",
    "course": "MONTADOR E REPARADOR DE COMPUTADORES",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 20.0,
    "n_classes": 12,
    "attend_rate": 100.0,
    "evasao": 5.0,
    "evasao_pct": 20.0
  },
  {
    "unit": "CEDESP 1",
    "period": "Tarde",
    "course": "OPERADOR DE COMPUTADOR",
    "meta": 20.0,
    "matr": 23.0,
    "freq_avg": 21.6,
    "n_classes": 12,
    "attend_rate": 108.0,
    "evasao": 1.4,
    "evasao_pct": 6.1
  },
  {
    "unit": "CEDESP 1",
    "period": "Noite",
    "course": "CABELEIREIRO",
    "meta": 20.0,
    "matr": 34.0,
    "freq_avg": 20.5,
    "n_classes": 12,
    "attend_rate": 102.5,
    "evasao": 13.5,
    "evasao_pct": 39.7
  },
  {
    "unit": "CEDESP 1",
    "period": "Noite",
    "course": "MANICURE E PEDICURE",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 24.8,
    "n_classes": 12,
    "attend_rate": 124.0,
    "evasao": 5.2,
    "evasao_pct": 17.3
  },
  {
    "unit": "CEDESP 1",
    "period": "Noite",
    "course": "MONTADOR E REPARADOR DE COMPUTADORES",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 18.3,
    "n_classes": 12,
    "attend_rate": 91.5,
    "evasao": 6.7,
    "evasao_pct": 26.8
  },
  {
    "unit": "CEDESP 1",
    "period": "Noite",
    "course": "OPERADOR DE COMPUTADOR",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 22.9,
    "n_classes": 12,
    "attend_rate": 114.5,
    "evasao": 4.1,
    "evasao_pct": 15.2
  },
  {
    "unit": "CEDESP 2",
    "period": "Manh√£",
    "course": "COSTUREIRO INDUSTRIAL DO VESTU√ÅRIO",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 23.0,
    "n_classes": 12,
    "attend_rate": 115.0,
    "evasao": 5.0,
    "evasao_pct": 17.9
  },
  {
    "unit": "CEDESP 2",
    "period": "Manh√£",
    "course": "ORGANIZADOR DE EVENTOS",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 20.9,
    "n_classes": 11,
    "attend_rate": 104.5,
    "evasao": 5.1,
    "evasao_pct": 19.6
  },
  {
    "unit": "CEDESP 2",
    "period": "Tarde",
    "course": "ALFAIATE",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 19.6,
    "n_classes": 12,
    "attend_rate": 98.0,
    "evasao": 5.4,
    "evasao_pct": 21.6
  },
  {
    "unit": "CEDESP 2",
    "period": "Tarde",
    "course": "COSTUREIRO INDUSTRIAL DO VESTU√ÅRIO",
    "meta": 20.0,
    "matr": 29.0,
    "freq_avg": 24.2,
    "n_classes": 12,
    "attend_rate": 121.0,
    "evasao": 4.8,
    "evasao_pct": 16.6
  },
  {
    "unit": "CEDESP 2",
    "period": "Tarde",
    "course": "DESENHISTA DE MODA",
    "meta": 20.0,
    "matr": 14.0,
    "freq_avg": 11.1,
    "n_classes": 12,
    "attend_rate": 55.5,
    "evasao": 2.9,
    "evasao_pct": 20.7
  },
  {
    "unit": "CEDESP 2",
    "period": "Tarde",
    "course": "INSTALADOR DE SISTEMAS ELETR√îNICOS DE SEGURAN√áA",
    "meta": 20.0,
    "matr": 11.0,
    "freq_avg": 7.9,
    "n_classes": 11,
    "attend_rate": 39.5,
    "evasao": 3.1,
    "evasao_pct": 28.2
  },
  {
    "unit": "CEDESP 2",
    "period": "Tarde",
    "course": "ORGANIZADOR DE EVENTOS",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 19.9,
    "n_classes": 11,
    "attend_rate": 99.5,
    "evasao": 5.1,
    "evasao_pct": 20.4
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "ALFAIATE",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 20.6,
    "n_classes": 12,
    "attend_rate": 103.0,
    "evasao": 7.4,
    "evasao_pct": 26.4
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "COSTUREIRO INDUSTRIAL DO VESTU√ÅRIO",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 23.8,
    "n_classes": 12,
    "attend_rate": 119.0,
    "evasao": 4.2,
    "evasao_pct": 15.0
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "DESENHISTA DE MODA",
    "meta": 20.0,
    "matr": 24.0,
    "freq_avg": 18.2,
    "n_classes": 12,
    "attend_rate": 91.0,
    "evasao": 5.8,
    "evasao_pct": 24.2
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS  - B",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 17.9,
    "n_classes": 11,
    "attend_rate": 89.5,
    "evasao": 12.1,
    "evasao_pct": 40.3
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "INSTALADOR DE SISTEMAS ELETR√îNICOS DE SEGURAN√áA",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 23.4,
    "n_classes": 11,
    "attend_rate": 117.0,
    "evasao": 6.6,
    "evasao_pct": 22.0
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "MODELISTA DE ROUPAS",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 23.1,
    "n_classes": 10,
    "attend_rate": 115.5,
    "evasao": 3.9,
    "evasao_pct": 14.4
  },
  {
    "unit": "CEDESP 2",
    "period": "Noite",
    "course": "OPERADOR PARA INJETORA PARA TERMOPL√ÅSTICOS",
    "meta": 20.0,
    "matr": 20.0,
    "freq_avg": 14.0,
    "n_classes": 11,
    "attend_rate": 70.0,
    "evasao": 6.0,
    "evasao_pct": 30.0
  },
  {
    "unit": "CEDESP 3",
    "period": "Manh√£",
    "course": "AUXILIAR DE MANUTEN√á√ÉO PREDIAL (ELETRICISTA) - TURMA A",
    "meta": 20.0,
    "matr": 21.0,
    "freq_avg": 16.2,
    "n_classes": 10,
    "attend_rate": 81.0,
    "evasao": 4.8,
    "evasao_pct": 22.9
  },
  {
    "unit": "CEDESP 3",
    "period": "Manh√£",
    "course": "MONTADOR DE EQUIPAMENTOS ELETROELETR√îNICOS",
    "meta": 20.0,
    "matr": 20.0,
    "freq_avg": 9.7,
    "n_classes": 6,
    "attend_rate": 48.5,
    "evasao": 10.3,
    "evasao_pct": 51.5
  },
  {
    "unit": "CEDESP 3",
    "period": "Tarde",
    "course": "AUXILIAR DE MANUTEN√á√ÉO PREDIAL (ELETRICISTA) - TURMA A",
    "meta": 20.0,
    "matr": 12.0,
    "freq_avg": 9.1,
    "n_classes": 12,
    "attend_rate": 45.5,
    "evasao": 2.9,
    "evasao_pct": 24.2
  },
  {
    "unit": "CEDESP 3",
    "period": "Tarde",
    "course": "AUXILIAR DE MANUTEN√á√ÉO PREDIAL (ELETRICISTA) - TURMA B",
    "meta": 20.0,
    "matr": 12.0,
    "freq_avg": 8.0,
    "n_classes": 10,
    "attend_rate": 40.0,
    "evasao": 4.0,
    "evasao_pct": 33.3
  },
  {
    "unit": "CEDESP 3",
    "period": "Tarde",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS  - A",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 27.3,
    "n_classes": 12,
    "attend_rate": 136.5,
    "evasao": 0.7,
    "evasao_pct": 2.5
  },
  {
    "unit": "CEDESP 3",
    "period": "Tarde",
    "course": "MONTADOR DE EQUIPAMENTOS ELETROELETR√îNICOS",
    "meta": 20.0,
    "matr": 17.0,
    "freq_avg": 14.3,
    "n_classes": 12,
    "attend_rate": 71.5,
    "evasao": 2.7,
    "evasao_pct": 15.9
  },
  {
    "unit": "CEDESP 3",
    "period": "Tarde",
    "course": "MONTADOR DE PAINEIS EL√âTRICOS",
    "meta": 20.0,
    "matr": 24.0,
    "freq_avg": 19.5,
    "n_classes": 12,
    "attend_rate": 97.5,
    "evasao": 4.5,
    "evasao_pct": 18.8
  },
  {
    "unit": "CEDESP 3",
    "period": "Noite",
    "course": "AUXILIAR DE MANUTEN√á√ÉO PREDIAL (ELETRICISTA) - TURMA A",
    "meta": 20.0,
    "matr": 20.0,
    "freq_avg": 16.3,
    "n_classes": 12,
    "attend_rate": 81.5,
    "evasao": 3.7,
    "evasao_pct": 18.5
  },
  {
    "unit": "CEDESP 3",
    "period": "Noite",
    "course": "AUXILIAR DE MANUTEN√á√ÉO PREDIAL (ELETRICISTA) - TURMA B",
    "meta": 20.0,
    "matr": 22.0,
    "freq_avg": 20.2,
    "n_classes": 11,
    "attend_rate": 101.0,
    "evasao": 1.8,
    "evasao_pct": 8.2
  },
  {
    "unit": "CEDESP 3",
    "period": "Noite",
    "course": "ELETRICISTA INDUSTRIAL",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 23.4,
    "n_classes": 11,
    "attend_rate": 117.0,
    "evasao": 3.6,
    "evasao_pct": 13.3
  },
  {
    "unit": "CEDESP 3",
    "period": "Noite",
    "course": "MONTADOR DE EQUIPAMENTOS ELETROELETR√îNICOS",
    "meta": 20.0,
    "matr": 36.0,
    "freq_avg": 21.0,
    "n_classes": 2,
    "attend_rate": 105.0,
    "evasao": 15.0,
    "evasao_pct": 41.7
  },
  {
    "unit": "CEDESP 3",
    "period": "Noite",
    "course": "MONTADOR DE PAINEIS EL√âTRICOS",
    "meta": 20.0,
    "matr": 36.0,
    "freq_avg": 26.0,
    "n_classes": 12,
    "attend_rate": 130.0,
    "evasao": 10.0,
    "evasao_pct": 27.8
  },
  {
    "unit": "CEDESP 4",
    "period": "Manh√£",
    "course": "ASSISTENTE ADMINISTRATIVO - A",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 21.8,
    "n_classes": 12,
    "attend_rate": 109.0,
    "evasao": 4.2,
    "evasao_pct": 16.2
  },
  {
    "unit": "CEDESP 4",
    "period": "Manh√£",
    "course": "ASSISTENTE ADMINISTRATIVO - B",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 21.7,
    "n_classes": 12,
    "attend_rate": 108.5,
    "evasao": 4.3,
    "evasao_pct": 16.5
  },
  {
    "unit": "CEDESP 4",
    "period": "Manh√£",
    "course": "ASSISTENTE DE RECURSOS HUMANOS",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 20.0,
    "n_classes": 12,
    "attend_rate": 100.0,
    "evasao": 6.0,
    "evasao_pct": 23.1
  },
  {
    "unit": "CEDESP 4",
    "period": "Manh√£",
    "course": "COZINHEIRO INDUSTRIAL",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 20.2,
    "n_classes": 9,
    "attend_rate": 101.0,
    "evasao": 4.8,
    "evasao_pct": 19.2
  },
  {
    "unit": "CEDESP 4",
    "period": "Tarde",
    "course": "ASSISTENTE ADMINISTRATIVO - A",
    "meta": 20.0,
    "matr": 29.0,
    "freq_avg": 25.5,
    "n_classes": 12,
    "attend_rate": 127.5,
    "evasao": 3.5,
    "evasao_pct": 12.1
  },
  {
    "unit": "CEDESP 4",
    "period": "Tarde",
    "course": "ASSISTENTE ADMINISTRATIVO - B",
    "meta": 20.0,
    "matr": 29.0,
    "freq_avg": 23.2,
    "n_classes": 12,
    "attend_rate": 116.0,
    "evasao": 5.8,
    "evasao_pct": 20.0
  },
  {
    "unit": "CEDESP 4",
    "period": "Tarde",
    "course": "ASSISTENTE DE RECURSOS HUMANOS",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 22.8,
    "n_classes": 12,
    "attend_rate": 114.0,
    "evasao": 4.2,
    "evasao_pct": 15.6
  },
  {
    "unit": "CEDESP 4",
    "period": "Tarde",
    "course": "COZINHEIRO INDUSTRIAL",
    "meta": 20.0,
    "matr": 22.0,
    "freq_avg": 16.1,
    "n_classes": 12,
    "attend_rate": 80.5,
    "evasao": 5.9,
    "evasao_pct": 26.8
  },
  {
    "unit": "CEDESP 4",
    "period": "Noite",
    "course": "ASSISTENTE ADMINISTRATIVO - A",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 23.4,
    "n_classes": 10,
    "attend_rate": 117.0,
    "evasao": 4.6,
    "evasao_pct": 16.4
  },
  {
    "unit": "CEDESP 4",
    "period": "Noite",
    "course": "ASSISTENTE ADMINISTRATIVO - B",
    "meta": 20.0,
    "matr": 31.0,
    "freq_avg": 28.1,
    "n_classes": 12,
    "attend_rate": 140.5,
    "evasao": 2.9,
    "evasao_pct": 9.4
  },
  {
    "unit": "CEDESP 4",
    "period": "Noite",
    "course": "ASSISTENTE DE RECURSOS HUMANOS",
    "meta": 20.0,
    "matr": 33.0,
    "freq_avg": 24.7,
    "n_classes": 11,
    "attend_rate": 123.5,
    "evasao": 8.3,
    "evasao_pct": 25.2
  },
  {
    "unit": "CEDESP 4",
    "period": "Noite",
    "course": "COZINHEIRO INDUSTRIAL",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 24.5,
    "n_classes": 12,
    "attend_rate": 122.5,
    "evasao": 3.5,
    "evasao_pct": 12.5
  },
  {
    "unit": "CEDESP 5",
    "period": "Manh√£",
    "course": "AUXILIAR DE MANUTEN√á√ÉO PREDIAL (ELETRICISTA) - TURMA B",
    "meta": 20.0,
    "matr": 20.0,
    "freq_avg": 16.0,
    "n_classes": 3,
    "attend_rate": 80.0,
    "evasao": 4.0,
    "evasao_pct": 20.0
  },
  {
    "unit": "CEDESP 5",
    "period": "Manh√£",
    "course": "PEDREIRO DE ALVENARIA",
    "meta": 20.0,
    "matr": 18.0,
    "freq_avg": 11.7,
    "n_classes": 12,
    "attend_rate": 58.5,
    "evasao": 6.3,
    "evasao_pct": 35.0
  },
  {
    "unit": "CEDESP 5",
    "period": "Manh√£",
    "course": "PROGRAMADOR DE SISTEMAS",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 21.8,
    "n_classes": 12,
    "attend_rate": 109.0,
    "evasao": 5.2,
    "evasao_pct": 19.3
  },
  {
    "unit": "CEDESP 5",
    "period": "Manh√£",
    "course": "PROGRAMADOR WEB",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 18.5,
    "n_classes": 12,
    "attend_rate": 92.5,
    "evasao": 8.5,
    "evasao_pct": 31.5
  },
  {
    "unit": "CEDESP 5",
    "period": "Tarde",
    "course": "EDITOR DE PROJETOS VISUAIS GR√ÅFICOS",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 20.5,
    "n_classes": 11,
    "attend_rate": 102.5,
    "evasao": 9.5,
    "evasao_pct": 31.7
  },
  {
    "unit": "CEDESP 5",
    "period": "Tarde",
    "course": "PROGRAMADOR DE SISTEMAS",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 25.8,
    "n_classes": 12,
    "attend_rate": 129.0,
    "evasao": 0.2,
    "evasao_pct": 0.8
  },
  {
    "unit": "CEDESP 5",
    "period": "Tarde",
    "course": "PROGRAMADOR WEB",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 24.2,
    "n_classes": 12,
    "attend_rate": 121.0,
    "evasao": 5.8,
    "evasao_pct": 19.3
  },
  {
    "unit": "CEDESP 5",
    "period": "Tarde",
    "course": "SER√çGRAFO",
    "meta": 20.0,
    "matr": 10.0,
    "freq_avg": 6.5,
    "n_classes": 11,
    "attend_rate": 32.5,
    "evasao": 3.5,
    "evasao_pct": 35.0
  },
  {
    "unit": "CEDESP 5",
    "period": "Noite",
    "course": "ANIMADOR DE STOP MOTION",
    "meta": 20.0,
    "matr": 20.0,
    "freq_avg": 15.1,
    "n_classes": 11,
    "attend_rate": 75.5,
    "evasao": 4.9,
    "evasao_pct": 24.5
  },
  {
    "unit": "CEDESP 5",
    "period": "Noite",
    "course": "EDITOR DE PROJETOS VISUAIS GR√ÅFICOS",
    "meta": 20.0,
    "matr": 23.0,
    "freq_avg": 18.3,
    "n_classes": 11,
    "attend_rate": 91.5,
    "evasao": 4.7,
    "evasao_pct": 20.4
  },
  {
    "unit": "CEDESP 5",
    "period": "Noite",
    "course": "PEDREIRO DE ALVENARIA",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 22.8,
    "n_classes": 12,
    "attend_rate": 114.0,
    "evasao": 2.2,
    "evasao_pct": 8.8
  },
  {
    "unit": "CEDESP 5",
    "period": "Noite",
    "course": "PROGRAMADOR DE SISTEMAS",
    "meta": 20.0,
    "matr": 25.0,
    "freq_avg": 21.8,
    "n_classes": 12,
    "attend_rate": 109.0,
    "evasao": 3.2,
    "evasao_pct": 12.8
  },
  {
    "unit": "CEDESP 5",
    "period": "Noite",
    "course": "PROGRAMADOR WEB",
    "meta": 20.0,
    "matr": 31.0,
    "freq_avg": 23.5,
    "n_classes": 11,
    "attend_rate": 117.5,
    "evasao": 7.5,
    "evasao_pct": 24.2
  },
  {
    "unit": "CEDESP 5",
    "period": "Noite",
    "course": "SER√çGRAFO",
    "meta": 20.0,
    "matr": 31.0,
    "freq_avg": 21.8,
    "n_classes": 8,
    "attend_rate": 109.0,
    "evasao": 9.2,
    "evasao_pct": 29.7
  },
  {
    "unit": "CEDESP 6",
    "period": "Manh√£",
    "course": "CONFEITEIRO (COM NO√á√ïES DE SORVETERIA)",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 22.2,
    "n_classes": 12,
    "attend_rate": 111.0,
    "evasao": 4.8,
    "evasao_pct": 17.8
  },
  {
    "unit": "CEDESP 6",
    "period": "Manh√£",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS - B",
    "meta": 20.0,
    "matr": 29.0,
    "freq_avg": 20.8,
    "n_classes": 4,
    "attend_rate": 104.0,
    "evasao": 8.2,
    "evasao_pct": 28.3
  },
  {
    "unit": "CEDESP 6",
    "period": "Manh√£",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS - C",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 20.8,
    "n_classes": 12,
    "attend_rate": 104.0,
    "evasao": 5.2,
    "evasao_pct": 20.0
  },
  {
    "unit": "CEDESP 6",
    "period": "Manh√£",
    "course": "PADEIRO",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 22.5,
    "n_classes": 11,
    "attend_rate": 112.5,
    "evasao": 4.5,
    "evasao_pct": 16.7
  },
  {
    "unit": "CEDESP 6",
    "period": "Tarde",
    "course": "CONFEITEIRO (COM NO√á√ïES DE SORVETERIA)",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 24.8,
    "n_classes": 12,
    "attend_rate": 124.0,
    "evasao": 3.2,
    "evasao_pct": 11.4
  },
  {
    "unit": "CEDESP 6",
    "period": "Tarde",
    "course": "PADEIRO",
    "meta": 20.0,
    "matr": 28.0,
    "freq_avg": 18.9,
    "n_classes": 11,
    "attend_rate": 94.5,
    "evasao": 9.1,
    "evasao_pct": 32.5
  },
  {
    "unit": "CEDESP 6",
    "period": "Noite",
    "course": "CONFEITEIRO (COM NO√á√ïES DE SORVETERIA)",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 25.9,
    "n_classes": 12,
    "attend_rate": 129.5,
    "evasao": 4.1,
    "evasao_pct": 13.7
  },
  {
    "unit": "CEDESP 6",
    "period": "Noite",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS - A",
    "meta": 20.0,
    "matr": 23.0,
    "freq_avg": 20.0,
    "n_classes": 1,
    "attend_rate": 100.0,
    "evasao": 3.0,
    "evasao_pct": 13.0
  },
  {
    "unit": "CEDESP 6",
    "period": "Noite",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS - C",
    "meta": 20.0,
    "matr": 39.0,
    "freq_avg": 34.2,
    "n_classes": 12,
    "attend_rate": 171.0,
    "evasao": 4.8,
    "evasao_pct": 12.3
  },
  {
    "unit": "CEDESP 6",
    "period": "Noite",
    "course": "PADEIRO",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 22.0,
    "n_classes": 11,
    "attend_rate": 110.0,
    "evasao": 5.0,
    "evasao_pct": 18.5
  },
  {
    "unit": "CEDESP 7",
    "period": "Manh√£",
    "course": "ELETRICISTA DE SISTEMAS DE ENERGIAS RENOV√ÅVEIS",
    "meta": 20.0,
    "matr": 16.0,
    "freq_avg": 12.5,
    "n_classes": 12,
    "attend_rate": 62.5,
    "evasao": 3.5,
    "evasao_pct": 21.9
  },
  {
    "unit": "CEDESP 7",
    "period": "Manh√£",
    "course": "MEC√ÇNICO DE USINAGEM (Eletromec√¢nico de Autom√≥veis)",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 16.1,
    "n_classes": 11,
    "attend_rate": 80.5,
    "evasao": 10.9,
    "evasao_pct": 40.4
  },
  {
    "unit": "CEDESP 7",
    "period": "Tarde",
    "course": "ELETROMEC√ÇNICO DE AUTOM√ìVEIS  - B",
    "meta": 20.0,
    "matr": 24.0,
    "freq_avg": 12.2,
    "n_classes": 5,
    "attend_rate": 61.0,
    "evasao": 11.8,
    "evasao_pct": 49.2
  },
  {
    "unit": "CEDESP 7",
    "period": "Tarde",
    "course": "MEC√ÇNICO DE USINAGEM CONVENCIONAL",
    "meta": 20.0,
    "matr": 12.0,
    "freq_avg": 10.9,
    "n_classes": 10,
    "attend_rate": 54.5,
    "evasao": 1.1,
    "evasao_pct": 9.2
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "ELETRICISTA DE SISTEMAS DE ENERGIAS RENOV√ÅVEIS",
    "meta": 20.0,
    "matr": 26.0,
    "freq_avg": 22.8,
    "n_classes": 11,
    "attend_rate": 114.0,
    "evasao": 3.2,
    "evasao_pct": 12.3
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "MEC√ÇNICO DE USINAGEM CONVENCIONAL - A",
    "meta": 20.0,
    "matr": 21.0,
    "freq_avg": 15.8,
    "n_classes": 12,
    "attend_rate": 79.0,
    "evasao": 5.2,
    "evasao_pct": 24.8
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "MEC√ÇNICO DE USINAGEM CONVENCIONAL - B",
    "meta": 20.0,
    "matr": 18.0,
    "freq_avg": 13.8,
    "n_classes": 12,
    "attend_rate": 69.0,
    "evasao": 4.2,
    "evasao_pct": 23.3
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "OPERADOR DE TORNO COM CNC - A",
    "meta": 20.0,
    "matr": 23.0,
    "freq_avg": 19.0,
    "n_classes": 12,
    "attend_rate": 95.0,
    "evasao": 4.0,
    "evasao_pct": 17.4
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "OPERADOR DE FRESADORA COM CNC",
    "meta": 20.0,
    "matr": 16.0,
    "freq_avg": 9.3,
    "n_classes": 12,
    "attend_rate": 46.5,
    "evasao": 6.7,
    "evasao_pct": 41.9
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "OPERADOR E PROGRAMADOR DE SISTEMAS AUTOMATIZADOS DE SOLDAGEM - A",
    "meta": 20.0,
    "matr": 30.0,
    "freq_avg": 16.7,
    "n_classes": 11,
    "attend_rate": 83.5,
    "evasao": 13.3,
    "evasao_pct": 44.3
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "OPERADOR E PROGRAMADOR DE SISTEMAS AUTOMATIZADOS DE SOLDAGEM - B",
    "meta": 20.0,
    "matr": 27.0,
    "freq_avg": 16.8,
    "n_classes": 12,
    "attend_rate": 84.0,
    "evasao": 10.2,
    "evasao_pct": 37.8
  },
  {
    "unit": "CEDESP 7",
    "period": "Noite",
    "course": "OPERADOR E PROGRAMADOR DE SISTEMAS AUTOMATIZADOS DE SOLDAGEM - C",
    "meta": 20.0,
    "matr": 16.0,
    "freq_avg": 13.4,
    "n_classes": 10,
    "attend_rate": 67.0,
    "evasao": 2.6,
    "evasao_pct": 16.2
  },
  {
    "unit": "CEDESP 8",
    "period": "Manh√£",
    "course": "ANIMADOR DE STOP MOTION",
    "meta": 20.0,
    "matr": 31.0,
    "freq_avg": 19.6,
    "n_classes": 11,
    "attend_rate": 98.0,
    "evasao": 11.4,
    "evasao_pct": 36.8
  },
  {
    "unit": "CEDESP 8",
    "period": "Manh√£",
    "course": "AUXILIAR PEDAG√ìGICO",
    "meta": 20.0,
    "matr": 41.0,
    "freq_avg": 27.7,
    "n_classes": 11,
    "attend_rate": 138.5,
    "evasao": 13.3,
    "evasao_pct": 32.4
  },
  {
    "unit": "CEDESP 8",
    "period": "Manh√£",
    "course": "CUIDADOR DE IDOSOS",
    "meta": 20.0,
    "matr": 36.0,
    "freq_avg": 22.3,
    "n_classes": 11,
    "attend_rate": 111.5,
    "evasao": 13.7,
    "evasao_pct": 38.1
  },
  {
    "unit": "CEDESP 8",
    "period": "Manh√£",
    "course": "OPERADOR DE COMPUTADOR",
    "meta": 20.0,
    "matr": 35.0,
    "freq_avg": 20.4,
    "n_classes": 11,
    "attend_rate": 102.0,
    "evasao": 14.6,
    "evasao_pct": 41.7
  },
  {
    "unit": "CEDESP 8",
    "period": "Tarde",
    "course": "ANIMADOR DE STOP MOTION",
    "meta": 20.0,
    "matr": 35.0,
    "freq_avg": 22.4,
    "n_classes": 11,
    "attend_rate": 112.0,
    "evasao": 12.6,
    "evasao_pct": 36.0
  },
  {
    "unit": "CEDESP 8",
    "period": "Tarde",
    "course": "AUXILIAR PEDAG√ìGICO",
    "meta": 20.0,
    "matr": 35.0,
    "freq_avg": 22.9,
    "n_classes": 11,
    "attend_rate": 114.5,
    "evasao": 12.1,
    "evasao_pct": 34.6
  },
  {
    "unit": "CEDESP 8",
    "period": "Tarde",
    "course": "CUIDADOR DE IDOSO",
    "meta": 20.0,
    "matr": 38.0,
    "freq_avg": 23.2,
    "n_classes": 11,
    "attend_rate": 116.0,
    "evasao": 14.8,
    "evasao_pct": 38.9
  },
  {
    "unit": "CEDESP 8",
    "period": "Tarde",
    "course": "OPERADOR DE COMPUTADOR",
    "meta": 20.0,
    "matr": 42.0,
    "freq_avg": 28.8,
    "n_classes": 11,
    "attend_rate": 144.0,
    "evasao": 13.2,
    "evasao_pct": 31.4
  }
];

let filterUnit='all', filterPeriod='all', sortMode='rate-desc', searchQuery='';

function getColor(r){ return r>=100?'#2d7a4f':r>=80?'#c97c1a':'#c84b31'; }
function getStatus(r){ return r>=100?{cls:'high',label:'‚úì Meta atingida'}:r>=80?{cls:'mid',label:'‚ö† Aten√ß√£o m√©dia'}:{cls:'low',label:'‚úó Aten√ß√£o imediata'}; }
function periodColor(p){ return p==='Manh√£'?'#c97c1a':p==='Tarde'?'#2b5f8a':'#4a3a7a'; }

function getFiltered(){
  return RAW.filter(d=>{
    if(filterUnit!=='all'&&d.unit!==filterUnit)return false;
    if(filterPeriod!=='all'&&d.period!==filterPeriod)return false;
    if(searchQuery&&!d.course.toLowerCase().includes(searchQuery)&&!d.unit.toLowerCase().includes(searchQuery))return false;
    return true;
  });
}

function getSorted(data){
  return [...data].sort((a,b)=>{
    if(sortMode==='rate-desc')return b.attend_rate-a.attend_rate;
    if(sortMode==='rate-asc')return a.attend_rate-b.attend_rate;
    if(sortMode==='matr-desc')return b.matr-a.matr;
    if(sortMode==='avg-desc')return b.freq_avg-a.freq_avg;
    if(sortMode==='unit')return a.unit.localeCompare(b.unit)||a.period.localeCompare(b.period);
    return 0;
  });
}

Chart.defaults.color='#8a8279';
Chart.defaults.font.family="'Poppins',sans-serif";
Chart.defaults.borderColor='#d8d2c8';
let charts={};

function buildCharts(data){
  Object.values(charts).forEach(c=>c&&c.destroy());
  const sorted=[...data].sort((a,b)=>a.attend_rate-b.attend_rate).slice(0,20);

  charts.bar=new Chart(document.getElementById('courseBarChart'),{
    type:'bar',
    data:{
      labels:sorted.map(d=>d.course.length>32?d.course.substring(0,30)+'‚Ä¶':d.course),
      datasets:[{label:'Taxa %',data:sorted.map(d=>d.attend_rate),backgroundColor:sorted.map(d=>getColor(d.attend_rate)+'cc'),borderColor:sorted.map(d=>getColor(d.attend_rate)),borderWidth:1,borderRadius:0}]
    },
    options:{indexAxis:'y',responsive:true,plugins:{legend:{display:false},tooltip:{backgroundColor:'#1a1612',borderColor:'#d8d2c8',borderWidth:1,callbacks:{label:ctx=>` ${ctx.raw.toFixed(1)}%  ‚Äî  ${sorted[ctx.dataIndex].unit} ¬∑ ${sorted[ctx.dataIndex].period}`}}},scales:{x:{min:0,max:120,grid:{color:'rgba(216,210,200,.4)'},ticks:{font:{size:10},callback:v=>v+'%'}},y:{grid:{display:false},ticks:{font:{size:10}}}}}
  });

  const bands=[
    {label:'‚â• 100% (Meta atingida)',min:100,max:Infinity,color:'#2d7a4f'},
    {label:'80‚Äì99.9% (Aten√ß√£o m√©dia)',min:80,max:100,color:'#c97c1a'},
    {label:'< 80% (Aten√ß√£o imediata)',min:0,max:80,color:'#c84b31'},
  ];
  charts.dist=new Chart(document.getElementById('distChart'),{
    type:'doughnut',
    data:{labels:bands.map(b=>b.label),datasets:[{data:bands.map(b=>data.filter(d=>d.attend_rate>=b.min&&d.attend_rate<b.max).length),backgroundColor:bands.map(b=>b.color+'cc'),borderColor:bands.map(b=>b.color),borderWidth:2,hoverOffset:8}]},
    options:{responsive:true,cutout:'58%',plugins:{legend:{position:'right',labels:{boxWidth:12,padding:12,font:{size:11},usePointStyle:true}},tooltip:{backgroundColor:'#1a1612',borderColor:'#d8d2c8',borderWidth:1}}}
  });

  const units=[...new Set(RAW.map(d=>d.unit))];
  const critImediata=units.map(u=>data.filter(d=>d.unit===u&&d.attend_rate<80).length);
  const critMedia=units.map(u=>data.filter(d=>d.unit===u&&d.attend_rate>=80&&d.attend_rate<100).length);
  const critOk=units.map(u=>data.filter(d=>d.unit===u&&d.attend_rate>=100).length);
  charts.unit=new Chart(document.getElementById('unitCompChart'),{
    type:'bar',
    data:{labels:units.map(u=>u.replace('CEDESP ','C')),datasets:[
      {label:'‚úó Aten√ß√£o imediata (<80%)',data:critImediata,backgroundColor:'rgba(200,75,49,.85)',borderColor:'#c84b31',borderWidth:1,borderRadius:0},
      {label:'‚ö† Aten√ß√£o m√©dia (80‚Äì99%)',data:critMedia,backgroundColor:'rgba(201,124,26,.85)',borderColor:'#c97c1a',borderWidth:1,borderRadius:0},
      {label:'‚úì Meta atingida (‚â•100%)',data:critOk,backgroundColor:'rgba(45,122,79,.85)',borderColor:'#2d7a4f',borderWidth:1,borderRadius:0}
    ]},
    options:{responsive:true,plugins:{legend:{position:'top',labels:{boxWidth:10,padding:10,font:{size:10}}},tooltip:{backgroundColor:'#1a1612',borderColor:'#d8d2c8',borderWidth:1,callbacks:{label:ctx=>{const u=units[ctx.dataIndex];const total=data.filter(d=>d.unit===u).length;return` ${ctx.dataset.label.split(' ')[0]} ${ctx.raw} turma${ctx.raw!==1?'s':''} de ${total}`;}}}},scales:{x:{stacked:true,grid:{display:false},ticks:{font:{size:11}}},y:{stacked:true,grid:{color:'rgba(216,210,200,.4)'},ticks:{font:{size:10},stepSize:1}}}}
  });

  const periods=['Manh√£','Tarde','Noite'];
  const pAvgs=periods.map(p=>{const r=data.filter(d=>d.period===p);return r.length?+(r.reduce((s,x)=>s+x.attend_rate,0)/r.length).toFixed(1):0;});
  charts.period=new Chart(document.getElementById('periodChart'),{
    type:'bar',
    data:{labels:['‚òÄ Manh√£','üå§ Tarde','üåô Noite'],datasets:[{label:'Taxa m√©dia %',data:pAvgs,backgroundColor:periods.map(p=>periodColor(p)+'cc'),borderColor:periods.map(p=>periodColor(p)),borderWidth:1.5,borderRadius:0}]},
    options:{responsive:true,plugins:{legend:{display:false},tooltip:{backgroundColor:'#1a1612',borderColor:'#d8d2c8',borderWidth:1}},scales:{x:{grid:{display:false},ticks:{font:{size:12}}},y:{min:40,max:100,grid:{color:'rgba(216,210,200,.4)'},ticks:{font:{size:10},callback:v=>v+'%'}}}}
  });
}

// ‚îÄ‚îÄ EVASION CHART ‚îÄ‚îÄ
let evasaoChart;
function buildEvasaoChart(data){
  if(evasaoChart)evasaoChart.destroy();
  const withEvasao=data.filter(d=>d.matr&&d.evasao!=null).sort((a,b)=>b.evasao_pct-a.evasao_pct).slice(0,20);
  const labels=withEvasao.map(d=>{const n=d.course.length>30?d.course.substring(0,28)+'‚Ä¶':d.course;return n+' ('+d.unit.replace('CEDESP ','C')+')';});
  evasaoChart=new Chart(document.getElementById('evasaoChart'),{
    type:'bar',
    data:{labels,datasets:[{
      label:'Evas√£o (alunos)',
      data:withEvasao.map(d=>d.evasao),
      backgroundColor:withEvasao.map(d=>d.evasao_pct>30?'rgba(200,75,49,.85)':d.evasao_pct>15?'rgba(201,124,26,.85)':'rgba(125,133,144,.6)'),
      borderColor:withEvasao.map(d=>d.evasao_pct>30?'#c84b31':d.evasao_pct>15?'#c97c1a':'#7d8590'),
      borderWidth:1,borderRadius:0
    }]},
    options:{
      indexAxis:'y',responsive:true,
      plugins:{
        legend:{display:false},
        tooltip:{backgroundColor:'#1a1612',borderColor:'#d8d2c8',borderWidth:1,
          callbacks:{label:ctx=>{const d=withEvasao[ctx.dataIndex];return` ${d.evasao.toFixed(0)} alunos evadidos ‚Äî ${d.evasao_pct.toFixed(1)}% ¬∑ ${d.period}`;}}
        }
      },
      scales:{
        x:{grid:{color:'rgba(216,210,200,.3)'},ticks:{font:{size:10}}},
        y:{grid:{display:false},ticks:{font:{size:10}}}
      }
    }
  });
}

function buildTable(data){
  const tbody=document.getElementById('courseTableBody');
  tbody.innerHTML='';
  const sorted=getSorted(data);
  document.getElementById('resultCount').textContent=sorted.length+' cursos';
  document.getElementById('emptyState').style.display=sorted.length?'none':'block';
  sorted.forEach(d=>{
    const st=getStatus(d.attend_rate);
    const cap=Math.min(d.attend_rate,100);
    const fc=getColor(d.attend_rate);
    const pd=d.period.toLowerCase().replace('√£','a');
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td><div class="course-name-cell">${d.course}</div></td>
      <td><span class="unit-chip">${d.unit.replace('CEDESP ','C')}</span></td>
      <td class="mono"><span class="period-dot ${pd}"></span>${d.period}</td>
      <td class="right mono">${d.matr||'‚Äî'}</td>
      <td class="right mono">${d.freq_avg.toFixed(1)}</td>
      <td class="right mono">${d.n_classes}</td>
      <td class="rate-cell"><div class="rate-wrap"><div class="rate-bar"><div class="rate-fill" style="width:${cap}%;background:${fc}"></div></div><div class="rate-pct" style="color:${fc}">${d.attend_rate.toFixed(1)}%</div></div></td>
      <td class="right mono">${d.evasao_pct!=null?'<span style="color:'+(d.evasao_pct>30?'#c84b31':d.evasao_pct>15?'#c97c1a':'#7d8590')+'">'+d.evasao_pct.toFixed(1)+'%</span>':'‚Äî'}</td>
      <td><span class="status-flag ${st.cls}">${st.label}</span></td>
    `;
    tbody.appendChild(tr);
  });
}

function updateKPIs(data){
  document.getElementById('kpi-cursos').textContent=data.length;
  const tm=data.reduce((s,d)=>s+(d.meta||0),0);
  const wr=tm>0?(data.reduce((s,d)=>s+d.attend_rate*(d.meta||0),0)/tm).toFixed(1)+'%':'‚Äî';
  document.getElementById('kpi-rate').textContent=wr;

  document.getElementById('kpi-low').textContent=data.filter(d=>d.attend_rate<80).length;
  const withEv=data.filter(d=>d.evasao_pct!=null);
  const avgEv=withEv.length?(withEv.reduce((s,d)=>s+d.evasao_pct,0)/withEv.length).toFixed(1):'‚Äî';
  document.getElementById('kpi-evasao').textContent=avgEv!=='‚Äî'?avgEv+'%':'‚Äî';
  document.getElementById('hdr-cursos').textContent=data.length;
  document.getElementById('hdr-avg').textContent=wr;
  document.getElementById('hdr-matr').textContent=data.reduce((s,d)=>s+(d.matr||0),0);
}

function update(){
  const f=getFiltered();
  updateKPIs(f);
  buildCharts(f);
  buildEvasaoChart(f);
  buildTable(f);
}

document.querySelectorAll('[data-filter="unit"]').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('[data-filter="unit"]').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');filterUnit=btn.dataset.value;update();
  });
});
document.querySelectorAll('[data-filter="period"]').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('[data-filter="period"]').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');filterPeriod=btn.dataset.value;update();
  });
});
document.getElementById('sortSelect').addEventListener('change',e=>{sortMode=e.target.value;buildTable(getFiltered());});
document.getElementById('searchInput').addEventListener('input',e=>{searchQuery=e.target.value.toLowerCase().trim();update();});

update();
</script>
</body>
</html>
